<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é›»è»Šã§æ–‡ç« é¡Œã‚¯ã‚¤ã‚º ğŸš†</title>
<style>
  :root{
    --bg:#f7f8fb; --card:#ffffff; --ink:#222; --muted:#666; --accent:#2f7dff;
    --ok:#22bb66; --ng:#ff4d4f; --rail:#c9d3e6;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    color:var(--ink); background:linear-gradient(180deg,#eef3ff 0%,#f8fbff 50%, var(--bg) 100%);
    display:flex; min-height:100svh; align-items:center; justify-content:center; padding:16px;
  }
  .app{
    background:var(--card); width:min(880px,100%); border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.08);
    overflow:hidden; border:1px solid #e8eefc;
  }
  header{
    padding:16px 20px; display:flex; gap:12px; align-items:center; justify-content:space-between; border-bottom:1px solid #eef2fe;
  }
  header .title{ font-weight:800; letter-spacing:.02em; display:flex; gap:8px; align-items:center; }
  header .title .train{ font-size:24px }
  header .meta{ display:flex; gap:16px; color:var(--muted); font-size:14px; align-items:center; }
  header .pill{ background:#f1f5ff; color:#2a5bd7; padding:6px 10px; border-radius:999px; font-weight:700 }

  .track{
    position:relative; height:120px; background:linear-gradient(180deg,#fff, #fbfdff);
    display:flex; align-items:flex-end; padding:0 20px 22px;
    border-bottom:1px solid #eef2fe;
  }
  .rail{
    position:relative; width:100%; height:10px; background:var(--rail); border-radius:6px; overflow:hidden;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.5), inset 0 -1px 0 rgba(0,0,0,.05);
  }
  .sleepers{
    position:absolute; inset:0; display:grid; grid-auto-flow:column; grid-auto-columns:32px; align-items:stretch;
  }
  .sleepers::before,.sleepers::after{
    content:""; display:block;
  }
  .sleepers div{ border-left:4px solid #b8c5dc; opacity:.7 }
  .train{
    position:absolute; bottom:46px; left:20px; translate:0 0; transition: transform .6s cubic-bezier(.2,.8,.2,1);
    font-size:34px; filter: drop-shadow(0 6px 8px rgba(0,0,0,.15));
  }

  .content{
    padding:20px; display:grid; gap:16px;
    grid-template-columns: 1fr 260px;
  }
  @media (max-width:720px){
    .content{ grid-template-columns: 1fr; }
  }

  .card{
    background:#fff; border:1px solid #eef2fe; border-radius:12px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.04);
  }
  .q{
    font-size:18px; line-height:1.6; white-space:pre-wrap;
  }
  .answer-row{
    display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;
  }
  input[type="number"], input[type="text"]{
    font-size:18px; padding:10px 12px; border:1px solid #dfe6fb; border-radius:10px; outline:none; width:220px;
  }
  input:focus{ border-color:var(--accent); box-shadow: 0 0 0 3px rgba(47,125,255,.15); }
  button{
    appearance:none; border:none; background:var(--accent); color:#fff; padding:10px 14px; border-radius:10px;
    font-weight:700; cursor:pointer; transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
    box-shadow:0 8px 20px rgba(47,125,255,.25);
  }
  button:active{ transform: translateY(1px) }
  .btn-ghost{ background:#eef4ff; color:#2a5bd7; box-shadow:none }
  .btn-danger{ background:var(--ng) }
  .btn-ok{ background:var(--ok) }

  .side{ display:grid; gap:12px; }
  .stat{ display:flex; justify-content:space-between; font-size:14px; color:var(--muted) }
  .progress{
    height:10px; background:#eef2fe; border-radius:999px; overflow:hidden;
  }
  .bar{ height:100%; width:0%; background:linear-gradient(90deg,#2f7dff,#5da7ff); transition: width .4s ease }
  .hint{ color:#2a5bd7; font-size:14px; background:#f4f8ff; padding:8px 10px; border-radius:8px; border:1px solid #e6efff }

  .result{
    display:none; font-size:18px; text-align:center; padding:8px 0;
  }
  .result.ok{ color:var(--ok) }
  .result.ng{ color:var(--ng) }

  .shake{ animation:shake .38s ease both }
  @keyframes shake{
    0%,100%{transform:translateX(0)}
    20%{transform:translateX(-6px)}
    40%{transform:translateX(6px)}
    60%{transform:translateX(-4px)}
    80%{transform:translateX(4px)}
  }
  .fade{ animation:fade .35s ease both }
  @keyframes fade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }

  footer{
    padding:12px 20px; border-top:1px solid #eef2fe; font-size:12px; color:var(--muted); display:flex; gap:8px; justify-content:space-between; flex-wrap:wrap;
  }
  .kbd{ font-family: ui-monospace, "SFMono-Regular", Menlo, Consolas, monospace; background:#f3f5fa; border:1px solid #e5e9f5; padding:2px 6px; border-radius:6px }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title"><span class="train">ğŸš†</span><span>é›»è»Šã§æ–‡ç« é¡Œã‚¯ã‚¤ã‚º</span></div>
      <div class="meta">
        <div class="pill">å°4å‘ã‘</div>
        <div>16å• / æ•°å­—å…¥åŠ›</div>
      </div>
    </header>

    <div class="track">
      <div class="rail">
        <div class="sleepers" id="sleepers"></div>
      </div>
      <div class="train" id="train" aria-hidden="true">ğŸš†</div>
    </div>

    <div class="content">
      <section class="card">
        <div class="q fade" id="question">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
        <div class="answer-row">
          <input id="answer" inputmode="numeric" pattern="[0-9]*" type="number" placeholder="ç­”ãˆã‚’å…¥åŠ›" />
          <button id="submit">ã“ãŸãˆã‚‹</button>
          <button id="next" class="btn-ghost">æ¬¡ã¸</button>
        </div>
        <div id="feedback" class="result" role="status" aria-live="polite"></div>
        <div id="hint" class="hint" style="display:none;"></div>
      </section>

      <aside class="side">
        <div class="card">
          <div class="stat"><span>é€²æ—</span><span><b id="pos">1</b>/<span id="total">10</span></span></div>
          <div class="progress"><div class="bar" id="bar"></div></div>
        </div>
        <div class="card">
          <div class="stat"><span>ã‚¹ã‚³ã‚¢</span><span><b id="score">0</b> ç‚¹ï¼ˆæ­£è§£1å•=10ç‚¹ï¼‰</span></div>
          <div class="stat"><span>ãƒ™ã‚¹ãƒˆ</span><span><b id="best">0</b> ç‚¹</span></div>
        </div>
        <div class="card" style="display:grid; gap:8px;">
          <button id="shuffle" class="btn-ghost">é †ç•ªã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã™ã‚‹</button>
          <button id="showHint" class="btn-ghost">ãƒ’ãƒ³ãƒˆ</button>
          <button id="restart" class="btn-danger">ã¯ã˜ã‚ã‹ã‚‰</button>
          <small style="color:var(--muted)">
            æ“ä½œãƒ’ãƒ³ãƒˆï¼š<span class="kbd">Enter</span> ã§å›ç­”ã€<span class="kbd">N</span> ã§æ¬¡ã¸
          </small>
        </div>
      </aside>
    </div>

    <footer>
      <div>Â© é›»è»Šã§å­¦ã¶ç®—æ•° / ãƒ­ãƒ¼ã‚«ãƒ«ã§ãã®ã¾ã¾å‹•ãã¾ã™</div>
      <div>å•é¡Œã¯ <span class="kbd">questions</span> é…åˆ—ã‚’æ›¸ãæ›ãˆã‚‹ã ã‘ã§å·®ã—æ›¿ãˆOK</div>
    </footer>
  </div>

<script>
/* ===========================
   1) å‡ºé¡Œãƒ‡ãƒ¼ã‚¿
   =========================== */
const questions = [
  // ãƒ¬ãƒ™ãƒ«1ï¼šãŸã—ç®—ãƒ»ã²ãç®—
  { text: "è¡Œãã¯5é§…ã¨ã¾ã‚Šã¾ã—ãŸã€‚å¸°ã‚Šã¯2é§…å°‘ãªãã¨ã¾ã‚Šã¾ã—ãŸã€‚ã‚ã‚ã›ã¦ä½•é§…ï¼Ÿ", answer: 8, hintType: "simple" },
  { text: "è¡Œãã¯7é§…ã¨ã¾ã‚Šã¾ã—ãŸã€‚å¸°ã‚Šã¯3é§…å°‘ãªãã¨ã¾ã‚Šã¾ã—ãŸã€‚ã‚ã‚ã›ã¦ä½•é§…ï¼Ÿ", answer: 11, hintType: "simple" },
  { text: "è¡Œãã¯6é§…ã¨ã¾ã‚Šã¾ã—ãŸã€‚å¸°ã‚Šã¯1é§…å°‘ãªãã¨ã¾ã‚Šã¾ã—ãŸã€‚ã‚ã‚ã›ã¦ä½•é§…ï¼Ÿ", answer: 11, hintType: "simple" },
  { text: "è¡Œãã¯8é§…ã¨ã¾ã‚Šã¾ã—ãŸã€‚å¸°ã‚Šã¯2é§…å°‘ãªãã¨ã¾ã‚Šã¾ã—ãŸã€‚ã‚ã‚ã›ã¦ä½•é§…ï¼Ÿ", answer: 14, hintType: "simple" },

  // ãƒ¬ãƒ™ãƒ«2ï¼š1.5å€
  { text: "Aãƒãƒ¼ãƒ ã¯1æ™‚é–“ã«4æœ¬è©¦åˆã‚’ã—ã¾ã™ã€‚Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã§ã™ã€‚Bãƒãƒ¼ãƒ ã¯ä½•æœ¬ï¼Ÿ", answer: 6, hintType: "ratioAB" },
  { text: "Aãƒãƒ¼ãƒ ã¯1æ™‚é–“ã«6æœ¬è©¦åˆã‚’ã—ã¾ã™ã€‚Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã§ã™ã€‚Bãƒãƒ¼ãƒ ã¯ä½•æœ¬ï¼Ÿ", answer: 9, hintType: "ratioAB" },
  { text: "Aãƒãƒ¼ãƒ ã¯1æ™‚é–“ã«2æœ¬è©¦åˆã‚’ã—ã¾ã™ã€‚Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã§ã™ã€‚Bãƒãƒ¼ãƒ ã¯ä½•æœ¬ï¼Ÿ", answer: 3, hintType: "ratioAB" },

  // ãƒ¬ãƒ™ãƒ«2.5ï¼šBâ†’Aã‚’æ±‚ã‚ã‚‹
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚Bãƒãƒ¼ãƒ ãŒ25äººã®ã¨ãã€Aãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 20, hintType: "BtoA", B:25 },
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚Bãƒãƒ¼ãƒ ãŒ40äººã®ã¨ãã€Aãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 30, hintType: "BtoA", B:40 },
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚Bãƒãƒ¼ãƒ ãŒ55äººã®ã¨ãã€Aãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 40, hintType: "BtoA", B:55 },

  // ãƒ¬ãƒ™ãƒ«2.75ï¼šAâ†’Bã‚’æ±‚ã‚ã‚‹
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚Aãƒãƒ¼ãƒ ãŒ20äººã®ã¨ãã€Bãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 25, hintType: "AtoB", A:20 },
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚Aãƒãƒ¼ãƒ ãŒ30äººã®ã¨ãã€Bãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 40, hintType: "AtoB", A:30 },
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚Aãƒãƒ¼ãƒ ãŒ40äººã®ã¨ãã€Bãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 55, hintType: "AtoB", A:40 },

  // ãƒ¬ãƒ™ãƒ«3ï¼šA+B=åˆè¨ˆ
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚2ãƒãƒ¼ãƒ ã§200äººã€‚Aãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 82, hintType: "totalAB", total:200 },
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚2ãƒãƒ¼ãƒ ã§95äººã€‚Aãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 40, hintType: "totalAB", total:95 },
  { text: "Bãƒãƒ¼ãƒ ã¯Aãƒãƒ¼ãƒ ã®1.5å€ã‚ˆã‚Š5äººå°‘ãªã„ã€‚2ãƒãƒ¼ãƒ ã§165äººã€‚Aãƒãƒ¼ãƒ ã¯ä½•äººï¼Ÿ", answer: 68, hintType: "totalAB", total:165 },
];

/* ===========================
   2) UI ã¨ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç•¥ï¼‰
   =========================== */
// ğŸ‘‡ï¼ˆå‰å›ã¨åŒã˜JSãƒ­ã‚¸ãƒƒã‚¯ã€‚ãŸã ã—SVGéƒ¨åˆ†ã®ãƒ©ãƒ™ãƒ«ã‚’ã€ŒAãƒãƒ¼ãƒ ï¼Bãƒãƒ¼ãƒ ã€ã«å¤‰æ›´ï¼‰

function svgLine(x1,y1,x2,y2,color="#2f7dff"){return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${color}" stroke-width="6" stroke-linecap="round"/>`;}
function svgText(x,y,txt,color="#333",size=14){return `<text x="${x}" y="${y}" fill="${color}" font-size="${size}" font-family="sans-serif">${txt}</text>`;}

function buildHint(q){
  const w=280,h=90;
  const svgHead=`<svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">`;
  let body="";
  switch(q.hintType){
    case "ratioAB":
      body+=svgLine(40,40,160,40,"#2f7dff");
      body+=svgLine(40,70,220,70,"#ff8c42");
      body+=svgText(10,45,"Aãƒãƒ¼ãƒ ");
      body+=svgText(10,75,"Bãƒãƒ¼ãƒ ");
      body+=svgText(230,75,"1.5å€");
      break;
    case "BtoA":
      body+=svgLine(40,40,220,40,"#ff8c42");
      body+=svgText(10,45,"Bãƒãƒ¼ãƒ ");
      body+=svgText(225,45,"âˆ’5");
      body+=svgLine(40,70,160,70,"#2f7dff");
      body+=svgText(10,75,"Aãƒãƒ¼ãƒ ");
      body+=svgText(165,75,"1.5å€");
      break;
    case "AtoB":
      body+=svgLine(40,40,160,40,"#2f7dff");
      body+=svgLine(40,70,220,70,"#ff8c42");
      body+=svgText(10,45,"Aãƒãƒ¼ãƒ ");
      body+=svgText(10,75,"Bãƒãƒ¼ãƒ ");
      body+=svgText(230,75,"âˆ’5");
      body+=svgText(165,75,"1.5å€");
      break;
    case "totalAB":
      body+=svgLine(40,40,160,40,"#2f7dff");
      body+=svgLine(40,70,220,70,"#ff8c42");
      body+=svgText(10,45,"Aãƒãƒ¼ãƒ ");
      body+=svgText(10,75,"Bãƒãƒ¼ãƒ ");
      body+=svgText(230,75,"âˆ’5");
      body+=svgText(165,75,"1.5å€");
      body+=svgText(100,20,`A+B=${q.total}`);
      break;
    default:
      body+=svgText(20,50,"ğŸªµ ã¾ãšã¯å•é¡Œæ–‡ã‚’ã‚ˆãèª­ã‚‚ã†ï¼");
  }
  return svgHead+body+"</svg>";
}
</script>

/* ===========================
   2) çŠ¶æ…‹ãƒ»è¦ç´ å–å¾—
   =========================== */
let order = [...questions.keys()]; // å‡ºé¡Œé †åºï¼ˆã‚·ãƒ£ãƒƒãƒ•ãƒ«å¯ï¼‰
let idx = 0;                       // ç¾åœ¨ã®å•é¡Œç•ªå·ï¼ˆorderä¸Šï¼‰
let score = 0;
let best = Number(localStorage.getItem("train_quiz_best") || 0);

const $ = (s)=>document.querySelector(s);
const qEl = $("#question");
const aEl = $("#answer");
const submitBtn = $("#submit");
const nextBtn = $("#next");
const feedback = $("#feedback");
const hintEl = $("#hint");
const posEl = $("#pos");
const totalEl = $("#total");
const barEl = $("#bar");
const scoreEl = $("#score");
const bestEl = $("#best");
const trainEl = $("#train");
const sleepers = $("#sleepers");

/* ãƒ¬ãƒ¼ãƒ«ã®æ•æœ¨ã‚’é©å½“ã«å¢—ã‚„ã™ï¼ˆè¦‹ãŸç›®ï¼‰ */
function buildSleepers(n=40){
  sleepers.innerHTML = "";
  for(let i=0;i<n;i++) sleepers.appendChild(document.createElement("div"));
}
buildSleepers();

/* ===========================
   3) åŸºæœ¬é–¢æ•°
   =========================== */
function render(){
  const i = order[idx];
  const total = questions.length;
  totalEl.textContent = total;
  posEl.textContent = idx+1;
  const {text} = questions[i];
  qEl.textContent = text;
  qEl.classList.remove("shake"); qEl.classList.add("fade");
  aEl.value = ""; aEl.focus({ preventScroll:true });
  feedback.style.display = "none";
  hintEl.style.display = "none";
  // é€²æ—ãƒãƒ¼
  barEl.style.width = `${(idx)/(total)*100}%`;
}

function moveTrain(){
  // ã‚³ãƒ³ãƒ†ãƒŠå¹…ã‹ã‚‰ã–ã£ãã‚Šè¨ˆç®—ï¼ˆé§…=å•é¡Œã®æ•°ï¼‰
  const total = questions.length;
  const track = document.querySelector(".track");
  const leftPad = 20, rightPad = 20;
  const usable = track.clientWidth - (leftPad+rightPad) - 40; // ã‚¢ã‚¤ã‚³ãƒ³å¹…ã®ä½™ç™½
  const step = usable / total;
  const x = leftPad + step * (idx+1);
  trainEl.style.transform = `translateX(${x}px)`;
}

function judge(){
  const i = order[idx];
  const ansExpected = String(questions[i].answer).trim();
  const ansUser = String(aEl.value ?? "").trim();
  const ok = ansUser !== "" && ansUser === ansExpected;

  feedback.style.display = "block";
  feedback.className = "result " + (ok ? "ok" : "ng");
  feedback.textContent = ok ? "âœ… æ­£è§£ï¼" : "âŒ ã¡ãŒã†ã‚ˆâ€¦";

  if(ok){
    score += 10;
    scoreEl.textContent = score;
    moveTrain();
    nextBtn.focus();
  }else{
    qEl.classList.remove("fade"); // ç›´å‰ã®fadeã‚’å¤–ã—ã¦ã‹ã‚‰
    void qEl.offsetWidth;         // reflow
    qEl.classList.add("shake");
  }
}

function next(){
  if(idx < questions.length-1){
    idx++;
    render();
  }else{
    // çµ‚äº†
    barEl.style.width = "100%";
    feedback.style.display = "block";
    feedback.className = "result ok";
    feedback.textContent = `ğŸ‰ åˆ°ç€ï¼ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯ ${score} ç‚¹`;
    if(score > best){
      best = score;
      localStorage.setItem("train_quiz_best", String(best));
    }
    bestEl.textContent = best;
  }
}

/* ===========================
   4) ã‚¤ãƒ™ãƒ³ãƒˆ
   =========================== */
submitBtn.addEventListener("click", judge);
nextBtn.addEventListener("click", next);
$("#restart").addEventListener("click", ()=>{
  score = 0; scoreEl.textContent = "0";
  idx = 0; order = [...questions.keys()];
  trainEl.style.transform = `translateX(0px)`;
  render();
});
$("#shuffle").addEventListener("click", ()=>{
  // ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼â€“ã‚¤ã‚§ãƒ¼ãƒ„ã§ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  order = [...questions.keys()];
  for(let i=order.length-1;i>0;i--){
    const j = Math.floor(Math.random() * (i+1));
    [order[i], order[j]] = [order[j], order[i]];
  }
  idx = 0; score = 0; scoreEl.textContent = "0";
  trainEl.style.transform = `translateX(0px)`;
  render();
});
$("#showHint").addEventListener("click", ()=>{
  const i = order[idx];
  hintEl.textContent = "ğŸ’¡ ãƒ’ãƒ³ãƒˆï¼š " + (questions[i].hint || "å•é¡Œæ–‡ã‚’ã‚ˆãèª­ã‚‚ã†ï¼");
  hintEl.style.display = "block";
});

/* ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ */
document.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){ judge(); }
  if(e.key.toLowerCase() === "n"){ next(); }
});

/* åˆæœŸåŒ– */
(function init(){
  bestEl.textContent = best;
  scoreEl.textContent = score;
  totalEl.textContent = questions.length;
  render();
})();
</script>
</body>
</html>
